# 작업 일지 — 2026-02-19

## 완료 작업

### 1. AI SDK 교체: Google Gemini → Anthropic Claude

| 항목 | Before | After |
|---|---|---|
| 패키지 | `@google/generative-ai ^0.24.1` | `@anthropic-ai/sdk ^0.39.0` |
| 모델 | `gemini-2.5-pro` | `claude-sonnet-4-20250514` |
| 환경변수 | `GEMINI_API_KEY` | `ANTHROPIC_API_KEY` |

**변경 파일:**

- `src/lib/gemini.ts` → 삭제
- `src/lib/anthropic.ts` → 신규 생성
  - `generateText()` — 단일 프롬프트 텍스트 생성
  - `chat()` — 히스토리 기반 비스트리밍 채팅
  - `chatStream()` — SSE 스트리밍 채팅 (대시보드 AI 어시스턴트에서 사용)
  - `isAnthropicAvailable()` — API 키 설정 여부 확인
- `src/app/api/ai/chat/route.ts` — Anthropic 메시지 포맷(`role: "assistant"`, `content: string`)으로 전환, 시스템 프롬프트를 `system` 파라미터로 분리

### 2. Next.js 다운그레이드: 16 → 15

Node.js v24 환경에서 Next.js 16 호환성 문제로 15로 변경.

| 항목 | Before | After |
|---|---|---|
| next | `^16.1.6` | `^15.3.0` (설치: 15.5.12) |
| @types/node | `^25.2.3` | `^22.15.0` |
| @types/react | `^19.2.14` | `^19.1.0` |
| @types/react-dom | `^19.2.3` | `^19.1.0` |
| react / react-dom | `^19.2.4` | `^19.1.0` |
| typescript | `^5.9.3` | `^5.7.0` |

### 검증 결과

- `npm run build` — 성공 (Next.js 15.5.12)
- `npm run dev` — 정상 기동 (port 3002)
- `npm test` — 15 passed / 2 failed
  - 실패 2건: 중복 이메일 테스트 — DB에 이전 테스트 데이터 잔존으로 인한 기존 이슈

---

## 향후 작업 제안

### 우선순위 높음

1. **ANTHROPIC_API_KEY 환경변수 설정**
   - `.env.local` 파일 생성 후 `ANTHROPIC_API_KEY=sk-ant-...` 설정
   - 운영 환경에서도 동일하게 설정 필요

2. **테스트 격리 문제 수정**
   - 중복 이메일 테스트 2건이 이전 실행 데이터 잔존 시 실패
   - `__tests__/setup.ts`의 `afterEach`에서 sessions 테이블도 정리하거나, 각 테스트에서 고유한 이메일 접미사 사용 검토

3. **DB SSH 터널링 문서화**
   - 현재 `DATABASE_URL` 환경변수로 연결 중이나 SSH 터널 설정 절차가 문서화되어 있지 않음
   - 개발환경 셋업 가이드에 터널 커맨드 예시 추가 권장

### 우선순위 중간

4. **AI 채팅 기능 고도화**
   - 현재 단순 텍스트 대화만 지원
   - DB 연결 기능 활용: 사용자 질문 → SQL 생성 → 실행 → 결과 시각화 파이프라인
   - 대시보드 데이터 컨텍스트를 시스템 프롬프트에 주입

5. **대시보드 데이터 시각화**
   - 현재 대시보드는 AI 채팅만 탑재
   - 차트 라이브러리(recharts, chart.js) 연동하여 데이터 시각화 구현
   - 데이터 소스 연결 및 쿼리 빌더 UI

6. **인증 강화**
   - 세션 만료 기간 설정 (현재 무기한)
   - 비밀번호 재설정 기능
   - OAuth 연동 (Google, GitHub)

### 우선순위 낮음

7. **CI/CD 파이프라인**
   - GitHub Actions로 테스트/빌드 자동화
   - 배포 파이프라인 구성

8. **에러 핸들링 개선**
   - 글로벌 에러 바운더리 컴포넌트
   - API 에러 응답 표준화
   - AI 스트리밍 에러 시 재시도 로직
